# 投票功能使用指南

## 功能概述

投票功能允许班级进行民主决策，包括：
- 班级事务投票（如班委选举、活动选择等）
- 单选和多选投票
- 实时结果统计
- 匿名/实名投票
- 防止重复投票

---

## 功能特性

### ✅ 已实现功能

1. **投票类型**
   - 单选投票：每人只能选择一个选项
   - 多选投票：可以选择多个选项（可设置最多选几项）

2. **投票管理**
   - 创建投票
   - 编辑投票
   - 删除投票
   - 停止/恢复投票
   - 查看投票结果

3. **投票参与**
   - 公开投票页面
   - 实时查看结果
   - 防止重复投票（基于IP）
   - 匿名或实名投票

4. **数据统计**
   - 每个选项的票数
   - 投票百分比
   - 进度条可视化
   - 总投票人数

---

## 使用教程

### 管理员操作

#### 1. 创建投票

1. 登录管理后台
2. 点击侧边栏"投票管理"
3. 点击"创建投票"按钮
4. 填写投票信息：
   - **投票标题**：例如"班级春游地点选择"
   - **投票描述**：简要说明投票内容
   - **投票类型**：选择单选或多选
   - **最多可选**：多选时设置最多可选几项
   - **截止时间**：设置投票结束时间
   - **允许匿名投票**：是否允许匿名
   - **投票选项**：至少添加2个选项
5. 点击"保存"

**示例：**
```
标题：班级春游地点选择
描述：请大家投票选择春游地点
类型：单选
截止时间：2025-11-30 18:00
允许匿名：是
选项：
  - 动物园
  - 植物园
  - 科技馆
  - 游乐园
```

#### 2. 编辑投票

1. 在投票列表中找到要编辑的投票
2. 点击"编辑"按钮
3. 修改投票信息
4. 点击"保存"

**注意：** 已经有人投票后，建议不要修改选项内容

#### 3. 查看投票结果

1. 在投票列表中点击"结果"按钮
2. 查看每个选项的票数和百分比
3. 通过进度条直观了解投票情况

#### 4. 停止/恢复投票

1. 点击投票后的"停止"按钮可以提前结束投票
2. 点击"恢复"按钮可以重新开启投票

#### 5. 删除投票

1. 点击"删除"按钮
2. 确认删除

**警告：** 删除投票会同时删除所有投票记录，无法恢复！

---

### 学生/访客操作

#### 1. 查看投票

1. 访问网站首页
2. 点击导航栏"投票"
3. 查看所有进行中和已结束的投票

#### 2. 参与投票

1. 在投票页面选择一个投票
2. 根据投票类型选择选项：
   - 单选：点击单选按钮
   - 多选：勾选复选框（注意最多可选数量）
3. 如果允许匿名，可以输入姓名（可选）
4. 点击"提交投票"按钮

**注意：**
- 每个IP地址只能投票一次
- 投票后无法修改
- 投票结束后无法再投票

#### 3. 查看结果

1. 在投票卡片上点击"查看结果"
2. 查看实时统计数据
3. 已投票的用户会看到"您已参与此投票"提示

---

## 投票状态说明

| 状态 | 说明 | 颜色 |
|------|------|------|
| 进行中 | 投票正在进行，可以参与 | 绿色 |
| 已结束 | 投票已过截止时间 | 红色 |
| 已停止 | 管理员手动停止 | 灰色 |

---

## API 接口

### 公开接口

```javascript
// 获取所有投票
GET /api/polls?status=active|ended|all

// 获取单个投票
GET /api/polls/:id

// 获取投票结果
GET /api/polls/:id/results

// 检查是否已投票
GET /api/polls/:id/check-voted

// 提交投票
POST /api/polls/:id/vote
Body: {
  optionIds: [1, 2],  // 选项ID数组
  voterName: "张三"   // 可选，匿名投票时的姓名
}
```

### 管理员接口（需要认证）

```javascript
// 创建投票
POST /api/polls
Body: {
  title: "投票标题",
  description: "投票描述",
  type: "single|multiple",
  maxChoices: 2,
  endDate: "2025-11-30T18:00:00Z",
  allowAnonymous: true,
  options: [
    { content: "选项1" },
    { content: "选项2" }
  ]
}

// 更新投票
PUT /api/polls/:id
Body: {
  title: "新标题",
  isActive: false
}

// 删除投票
DELETE /api/polls/:id
```

---

## 数据库模型

### Poll（投票）
```prisma
model Poll {
  id             Int      @id @default(autoincrement())
  title          String   // 投票标题
  description    String?  // 投票描述
  type           String   // single（单选）, multiple（多选）
  maxChoices     Int      @default(1) // 多选时最多可选几项
  startDate      DateTime @default(now())
  endDate        DateTime // 截止日期
  isActive       Boolean  @default(true)
  allowAnonymous Boolean  @default(true) // 是否允许匿名投票
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  options        PollOption[]
  votes          Vote[]
}
```

### PollOption（投票选项）
```prisma
model PollOption {
  id        Int      @id @default(autoincrement())
  pollId    Int
  content   String   // 选项内容
  order     Int      @default(0)
  createdAt DateTime @default(now())
  
  poll      Poll     @relation(fields: [pollId], references: [id], onDelete: Cascade)
  votes     Vote[]
}
```

### Vote（投票记录）
```prisma
model Vote {
  id        Int      @id @default(autoincrement())
  pollId    Int
  optionId  Int
  voterName String?  // 投票人姓名（匿名时为空）
  voterIp   String?  // IP地址（防止重复投票）
  createdAt DateTime @default(now())
  
  poll      Poll     @relation(fields: [pollId], references: [id], onDelete: Cascade)
  option    PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
}
```

---

## 使用场景示例

### 1. 班委选举
```
标题：班长候选人投票
类型：单选
选项：
  - 张三
  - 李四
  - 王五
截止时间：2025-11-20 17:00
允许匿名：否
```

### 2. 活动选择
```
标题：班级活动选择（可选3项）
类型：多选（最多3项）
选项：
  - 春游
  - 运动会
  - 文艺晚会
  - 知识竞赛
  - 志愿服务
截止时间：2025-11-25 18:00
允许匿名：是
```

### 3. 意见征集
```
标题：班服颜色投票
类型：单选
选项：
  - 蓝色
  - 红色
  - 绿色
  - 黄色
截止时间：2025-11-22 12:00
允许匿名：是
```

---

## 注意事项

### 管理员注意事项

1. **投票时间设置**
   - 确保截止时间合理，给大家足够的投票时间
   - 可以提前停止投票，但无法延长已结束的投票

2. **选项设置**
   - 选项内容要清晰明确
   - 至少提供2个选项
   - 多选投票的最多可选数不能超过选项总数

3. **数据安全**
   - 删除投票会删除所有相关数据
   - 建议在删除前导出结果（可以截图）

### 用户注意事项

1. **投票限制**
   - 每个IP只能投票一次
   - 投票后无法修改
   - 请谨慎选择

2. **匿名投票**
   - 匿名投票时可以选择是否填写姓名
   - 姓名仅用于统计，不会公开显示

---

## 常见问题

### Q1: 如何防止重复投票？
A: 系统通过IP地址识别用户，每个IP只能对同一个投票投一次票。

### Q2: 可以修改已投的票吗？
A: 不可以。投票提交后无法修改，请谨慎选择。

### Q3: 投票结果什么时候可以看？
A: 投票结果实时可见，任何人都可以点击"查看结果"按钮查看。

### Q4: 可以延长投票时间吗？
A: 可以。管理员可以编辑投票，修改截止时间。

### Q5: 删除投票会怎样？
A: 删除投票会同时删除所有投票记录和选项，无法恢复。

### Q6: 匿名投票和实名投票有什么区别？
A: 匿名投票时，用户可以选择是否填写姓名；实名投票时，系统不会收集姓名信息。两种方式都通过IP防止重复投票。

---

## 技术实现

### 前端技术
- React 18
- Ant Design 5
- Axios

### 后端技术
- Node.js + Express
- Prisma ORM
- SQLite

### 防重复投票机制
- 基于IP地址识别
- 数据库记录投票IP
- 投票前检查是否已投票

---

## 更新日志

### v1.0.0 (2025-11-17)
- ✅ 初始版本发布
- ✅ 支持单选和多选投票
- ✅ 实时结果统计
- ✅ 防重复投票
- ✅ 匿名/实名投票
- ✅ 管理后台完整功能

---

## 未来计划

- [ ] 投票提醒通知
- [ ] 投票结果导出（Excel/PDF）
- [ ] 投票历史记录
- [ ] 更多投票类型（评分、排序等）
- [ ] 投票评论功能
- [ ] 移动端优化

---

**开发时间：** 2025-11-17  
**版本：** 1.0.0  
**作者：** Kiro AI Assistant

---

如有问题或建议，请联系管理员。
